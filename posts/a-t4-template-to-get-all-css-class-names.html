


<!DOCTYPE html>
<html lang="en">
	<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=Edge"/>

	<title>Dave Glick - A T4 Template To Get All CSS Class Names</title>
        <meta name="description" content="The personal blog of Dave Glick" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">        

        <link type="application/rss+xml" rel="alternate" title="Dave Glick" href="/feed.rss" />
        <link type="application/atom+xml" rel="alternate" title="Dave Glick" href="/feed.atom" />
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/favicon.ico" type="image/x-icon">
        <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16" />

        <link href="/Content/bootstrap/bootstrap.css" rel="stylesheet" />
        <link href="/Content/prettify.css" rel="stylesheet">
        <link href="/Content/github.css" rel="stylesheet">
        <link href="/Content/master.css" rel="stylesheet" />

        <meta name="application-name" content="Dave Glick" />
        <meta name="msapplication-tooltip" content="Dave Glick" />
        <meta name="msapplication-starturl" content="/" />

        <meta property="og:title" content="Dave Glick - A T4 Template To Get All CSS Class Names" />
        
        <meta property="og:type" content="website" />
        <meta property="og:url" content="http://daveaglick.com/posts\a-t4-template-to-get-all-css-class-names.cshtml" />
        <!-- TODO: More social graph meta tags -->

        <script src="/Scripts/jquery-2.1.1.min.js"></script>
        <script src="/Scripts/bootstrap.min.js"></script>     
        <script src="/Scripts/prettify.js"></script>
        <script src="http://d3js.org/d3.v3.min.js"></script>
        <script src="/Scripts/trianglify.min.js"></script>
        <script src="/Scripts/Please-compressed.js"></script>
        <script src="//ajax.googleapis.com/ajax/libs/webfont/1.4.7/webfont.js"></script>
        <script>
            WebFont.load({
                google: {
                    families: ['Lato:400,900:latin', 'Droid+Serif::latin']
                },
                custom: {
                    families: ['daveaglick'],
                    urls: ['https://fontastic.s3.amazonaws.com/gfxCC547kHqmQZtxrW5KFY/icons.css']
                }
            });
        </script>
	</head>
	<body onload="prettyPrint()">

<div id="page-wrapper">
 <div class="container topnav container-sm-height">
  <div class="row nav-row row-sm-height">
   <div class="col-xs-3 col-sm-6 logo-col col-sm-height col-bottom">                        <a href="/">Dave Glick</a>
</div>
   <div class="col-xs-9 visible-xs-block">
    <div class="visible-xs-block">                            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".collapse">
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                                <span class="icon-bar"></span>
                            </button>
</div>
   </div>
   <div class="clearfix visible-xs-block"></div>
   <div class="col-xs-12 col-sm-2 nav-col collapse col-sm-height" style="visibility: visible;">
    <ul class="list-unstyled">
     <li>/ <a href="/about"> About</a></li>
     <li>/ <a href="/posts"> Archive</a></li>
     <li>/ <a href="/tags"> Tags</a></li>
     <li>/ <a href="/likes"> Likes</a></li>
    </ul>                        <a class="twitter-follow-button" href="https://twitter.com/daveaglick" data-show-count="false" data-lang="en">Follow @daveaglick</a>

   </div>
   <div class="clearfix visible-xs-block"></div>
   <div class="col-xs-12 col-sm-4 proj-col collapse col-sm-height" style="visibility: visible;">
    <div>Projects</div>
    <ul class="list-unstyled">
     <li>/ <a href="http://wyam.io">Wyam</a></li>
     <li>/ <a href="http://fluentbootstrap.com">FluentBootstrap</a></li>
     <li>/ <a href="https://github.com/daveaglick/LINQPad.CodeAnalysis">LINQPad.CodeAnalysis</a></li>
     <li>/ <a href="/razordatabase">RazorDatabase</a></li>
    </ul>
   </div>
  </div>
 </div>
 <div id="body-content" class="container">
  <div class="row">
   <div class="col-md-12">



<div class="banner container-sm-height">
 <div class="row row-sm-height">
  <div class="col-sm-8 col-sm-height col-bottom">            <div class="title">A T4 Template To Get All CSS Class Names</div>
                <div class="lead">Metaprogramming For Fun And Profit</div>
</div>
  <div class="col-sm-4 col-sm-height col-bottom stats">
   <div class="row">
    <div class="col-sm-12">                    <hr class="visible-xs-block" />
                        <div><strong>Tags</strong></div>
                        <div>

     <a role="button" href="/tags/css" class="btn btn-default btn-sm tag-button icon-tag-2"> CSS</a>
     <a role="button" href="/tags/t4" class="btn btn-default btn-sm tag-button icon-tag-2"> T4</a>                        </div>     
                        <div><strong>Published</strong></div>
                        <div class="icon-calendar"> &nbsp;Friday, October 10, 2014</div>
                    <div><strong>Comments</strong></div>
                    <div class="icon-talk-chat-2"> &nbsp;<a href="#disqus_thread" data-disqus-identifier="a-t4-template-to-get-all-css-class-names"></a></div>               
                    <div><a class="twitter-share-button" href="https://twitter.com/share" data-url="http://www.daveaglick.com/posts/a-t4-template-to-get-all-css-class-names" data-via="daveaglick" data-text="A T4 Template To Get All CSS Class Names" data-count="none">Tweet</a></div>

    </div>
   </div>
  </div>
 </div>
</div>
<hr />

<div class="row">
 <div id="post-content" class="col-sm-12"><p>This post combines two of my favorite things: meta-programming and the elimination of magic strings. The goal is to automatically generate a class with <code>static const</code> strings containing the name of all the CSS classes in your CSS files. Why would you want to do this? There are a number of reasons. First, it helps eliminate magic strings from your view code. Instead of writing <code>&lt;p class="my-class"&gt;</code> you can write <code>&lt;p class="@Css.MyClass"&gt;</code>. It also helps when writing view code because you'll have access to IntelliSense data for all of your CSS classes, making it easier to remember their names and avoid mistakes. Finally, it improves analysis and refactoring because you can now rely on code engines  to locate and operate on uses of a particular <code>const string</code> instead of just plain-text searching.</p>

<p>To accomplish this, we're going to use a <a href="http://msdn.microsoft.com/en-us/library/bb126445.aspx">T4 template</a>. If you're not familiar with T4 templates, they're a technology that was added to Visual Studio and are "a mixture of text blocks and control logic that can generate a text file". In short, they let you create code or other content for your application <em>before</em> compile time. They're very powerful, but are also a little like salting your food: a little bit goes a long way and you don't want to use too much.</p>

<p>This particular T4 template iterates over all the <code>.css</code> files in your web project, extracts all the CSS classes, and then spits them out into a series of <code>const</code> strings within a <code>static</code> class called <code>Css</code>. To use it, just create a new file at the root of your project called <code>Css.tt</code> and paste in the code below. Typically, T4 templates are only executed in Visual Studio when <em>they</em> change, not when other files in the project change. Since this template is actually looking at the <code>.css</code> files in your project, you may want a way to run it on every build. For that, I recommend installing <a href="https://visualstudiogallery.msdn.microsoft.com/84e6f033-6da3-4641-a058-12feef0a33b9">AutoT4</a>, which will automatically run all of your T4 templates on every build.</p>

<p>Here is the code for the T4 template. If it looks a little funny, don't worry. The T4 syntax is outside the scope of this blog post, but there are <a href="http://www.hanselman.com/blog/T4TextTemplateTransformationToolkitCodeGenerationBestKeptVisualStudioSecret.aspx">plenty of resources if you'd like to learn more</a>.</p>

<pre class="prettyprint">&lt;#@ template language=&quot;C#&quot; hostSpecific=&quot;true&quot; #&gt;
&lt;#@ assembly name=&quot;System.Core&quot; #&gt; 
&lt;#@ import namespace=&quot;System.Linq&quot; #&gt;
&lt;#@ import namespace=&quot;System.IO&quot; #&gt;
&lt;#@ import namespace=&quot;System.Collections.Generic&quot; #&gt;
&lt;#@ import namespace=&quot;System.Text.RegularExpressions&quot; #&gt;
&lt;# Process(); #&gt;
&lt;#+
	// Regex for CSS classes from http://paul.kinlan.me/regex-to-get-class-names-from-css-2-0/
	string cssClassRegex = @&quot;\.[-]?[_a-zA-Z][_a-zA-Z0-9-]*|[^\0-\177]*\\[0-9a-f]{1,6}(\r\n[ \n\r\t\f])?|\\[^\n\r\f0-9a-f]*&quot;;
	// Regexes for removing comments from http://stackoverflow.com/questions/3524317/regex-to-strip-line-comments-from-c-sharp/3524689#3524689
	string blockComments = @&quot;/\*(.*?)\*/&quot;;
	string lineComments = @&quot;//(.*?)\r?\n&quot;;
	string strings = @&quot;&quot;&quot;((\\[^\n]|[^&quot;&quot;\n])*)&quot;&quot;&quot;;
	string verbatimStrings = @&quot;@(&quot;&quot;[^&quot;&quot;]*&quot;&quot;)+&quot;;
	public void Process()
	{
		WriteLine(&quot;public static class Css&quot;);
		WriteLine(&quot;{&quot;);
		// Iterate all CSS files in the solution
		HashSet&lt;string&gt; cssClasses = new HashSet&lt;string&gt;();
		foreach(string fileName in Directory.GetFiles(Host.ResolvePath(@&quot;.&quot;), &quot;*.css&quot;, SearchOption.AllDirectories))
		{
			// Read the CSS file and strip comments
			string css = System.IO.File.ReadAllText(fileName);
			css = css.Replace(&quot;\r\n&quot;, &quot;\n&quot;);
			css = Regex.Replace(css,
				blockComments + &quot;|&quot; + lineComments + &quot;|&quot; + strings + &quot;|&quot; + verbatimStrings,
				me =&gt; {
					if (me.Value.StartsWith(&quot;/*&quot;) || me.Value.StartsWith(&quot;//&quot;))
						return me.Value.StartsWith(&quot;//&quot;) ? Environment.NewLine : &quot;&quot;;
					// Keep the literal strings
					return me.Value;
				},
				RegexOptions.Singleline);
			// Get all CSS classes in the file
			foreach (Match match in Regex.Matches(css, cssClassRegex))
			{
				if(match.Success &amp;&amp; !string.IsNullOrWhiteSpace(match.Groups[0].Value) &amp;&amp; !match.Groups[0].Value.StartsWith(@&quot;\&quot;))
				{
					cssClasses.Add(match.Groups[0].Value.Substring(1));	
				}
			}
		}
		// Generate the const strings
		HashSet&lt;string&gt; constNames = new HashSet&lt;string&gt;();
		foreach(string cssClass in cssClasses.OrderBy(x =&gt; x))
		{
			string constName = String.Join(null, cssClass.Split(new char[]{'-'}, StringSplitOptions.RemoveEmptyEntries)
				.Select(x =&gt; char.ToUpper(x[0]).ToString() + x.Substring(1)));
			string uniqueConstName = constName;
			int i = 1;
			while(!constNames.Add(uniqueConstName))
			{
				uniqueConstName = constName + &quot;_&quot; + i++;
			}
			WriteLine(&quot;\tpublic const string &quot; + uniqueConstName + &quot; = \&quot;&quot; + cssClass + &quot;\&quot;;&quot;);	
		}
		WriteLine(&quot;}&quot;);
	}
#&gt;</pre>
</div>
</div>
<hr />

<div class="row">
 <div class="col-sm-12">        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'somedave'; // required: replace example with your forum shortname
            var disqus_identifier = 'a-t4-template-to-get-all-css-class-names';
            var disqus_title = 'A T4 Template To Get All CSS Class Names';
            var disqus_url = 'http://www.daveaglick.com/posts/a-t4-template-to-get-all-css-class-names';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>    
</div>
</div></div>
  </div>
 </div>
</div>        
<div id="sticky-footer-wrapper">
 <div id="sticky-footer">
  <div class="container">
   <small>                        
                            Copyright © 2015 by Dave Glick. All jams and jellies preserved. The opinions expressed herein are my own and do not represent those of my employer or any other third-party views in any way. This work is licensed under a
                            <a href="http://creativecommons.org/licenses/by/4.0/" rel="license">
    <span class="icon-creative-commons"></span> Creative Commons Attribution 4.0 International License</a>.
                            <br />
                            <a href="/feed.rss">
    <span class="icon-rss"></span> RSS Feed</a> | <a href="/feed.atom">
    <span class="icon-rss"></span> Atom Feed</a>
                            <br />
                            <a href="https://github.com/daveaglick/daveaglick">
    <span class="icon-github-square"></span> This Site on GitHub</a> | <strong><a href="http://wyam.io">Generated by Wyam</a></strong>
                        

   </small>
  </div>
 </div>
</div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'somedave'; // required: replace example with your forum shortname

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var s = document.createElement('script'); s.async = true;
                s.type = 'text/javascript';
                s.src = '//' + disqus_shortname + '.disqus.com/count.js';
                (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
            }());

            // Google Analytics
            (function (i, s, o, g, r, a, m) {
                i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
                    (i[r].q = i[r].q || []).push(arguments)
                }, i[r].l = 1 * new Date(); a = s.createElement(o),
                m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
            })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

            ga('create', 'UA-54470483-1', 'auto');
            ga('send', 'pageview');

            // Twitter
            window.twttr = (function (d, s, id) {
                var t, js, fjs = d.getElementsByTagName(s)[0];
                if (d.getElementById(id)) return;
                js = d.createElement(s); js.id = id;
                js.src = "https://platform.twitter.com/widgets.js";
                fjs.parentNode.insertBefore(js, fjs);
                return window.twttr || (t = { _e: [], ready: function (f) { t._e.push(f) } });
            }(document, "script", "twitter-wjs"));

            // Background
            var colors = Please.make_color({
                golden: false,
                colors_returned: 3,
                saturation: .4
            });
            var t = new Trianglify({
                x_gradient: colors,
                y_gradient: ["#FFFFFF"]
            });
            var pattern = t.generate(document.body.clientWidth, document.body.clientHeight);
            document.body.setAttribute('style', 'background-image: ' + pattern.dataUrl);
        </script>
	</bodyonload="prettyPrint()">
</html>

